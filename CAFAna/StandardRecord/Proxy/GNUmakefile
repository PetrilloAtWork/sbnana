include SoftRelTools/arch_spec_root.mk

LIB_TYPE    := shared
LIB         := lib$(PACKAGE)Proxy
# Explicitly list generated files, because they might need to be created.
# 'sort' implies uniqueness, which we need, otherwise SRProxy.cxx is included
# twice on a second build.
LIBCXXFILES := $(sort $(wildcard *.cxx) SRProxy.cxx CheckEquals.cxx CopyRecord.cxx)

LIBLINK    := -l$(PACKAGE)Proxy

########################################################################
include SoftRelTools/standard.mk

# Generate this file if it doesn't exist. Depends on all the headers parsed to
# get it.
SRProxy.cxx: $(wildcard ../*.h) parse_xml.py
	./parse_xml.py

CheckEquals.cxx: $(wildcard ../*.h) parse_xml.py
	./parse_xml.py

CopyRecord.cxx: $(wildcard ../*.h) parse_xml.py
	./parse_xml.py

# Create the autogenerated files early on in the build process
codegen: SRProxy.cxx

# Clean up autogenerated files
clean_autogen:
	rm -f SRProxy.cxx SRProxy.h CheckEquals.cxx CheckEquals.h CopyRecord.cxx CopyRecord.h

# Do this in addition to usual cleaning
clean: clean_autogen
